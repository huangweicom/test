<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>财报管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        .navbar {
            background-color: #ffffff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .card {
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: none;
            margin-bottom: 20px;
        }
        .card-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #eaeaea;
            font-weight: 500;
        }
        .btn-primary {
            background-color: #3498db;
            border-color: #3498db;
        }
        .btn-primary:hover {
            background-color: #2980b9;
            border-color: #2980b9;
        }
        .form-control:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }
        .table {
            border-radius: 8px;
            overflow: hidden;
        }
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            background-color: #f8f9fa;
            cursor: pointer;
        }
        .upload-area:hover {
            border-color: #3498db;
            background-color: #f1f7fb;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="#">财报管理系统</a>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        上传财报
                    </div>
                    <div class="card-body">
                        <div class="upload-area" id="uploadArea">
                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="#3498db" class="bi bi-cloud-arrow-up mb-3" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"/>
                                    <path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"/>
                                </svg>
                                <h5>点击或拖拽文件到此处上传</h5>
                                <p class="text-muted">支持HTML文件</p>
                            </div>
                            <input type="file" id="fileInput" style="display: none;" accept=".html,.htm">
                        </div>

                        <form id="reportForm">
                            <div class="mb-3">
                                <label for="reportTitle" class="form-label">财报标题</label>
                                <input type="text" class="form-control" id="reportTitle" placeholder="请输入财报标题" required>
                            </div>
                            <div class="mb-3">
                                <label for="publishDate" class="form-label">发布日期</label>
                                <input type="date" class="form-control" id="publishDate" required>
                            </div>
                            <button type="submit" class="btn btn-primary">上传</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        财报列表
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>标题</th>
                                        <th>发布日期</th>
                                        <th>创建时间</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="reportsList">
                                    <!-- 财报列表将通过JavaScript动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 编辑弹窗 -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">编辑财报</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <input type="hidden" id="editId">
                        <div class="mb-3">
                            <label for="editTitle" class="form-label">财报标题</label>
                            <input type="text" class="form-control" id="editTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="editDate" class="form-label">发布日期</label>
                            <input type="date" class="form-control" id="editDate" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="saveEdit">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 删除确认弹窗 -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">确认删除</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>确定要删除这份财报吗？此操作不可撤销。</p>
                    <input type="hidden" id="deleteId">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-danger" id="confirmDelete">删除</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // API基础URL
        const API_BASE_URL = '/api';

        document.addEventListener('DOMContentLoaded', function() {
            // 加载财报列表
            loadReportsList();
            
            // 文件上传区域点击事件
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            
            uploadArea.addEventListener('click', function() {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    const fileName = e.target.files[0].name;
                    alert(`已选择文件: ${fileName}`);
                }
            });
            
            // 拖拽上传
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('border-primary');
            });
            
            uploadArea.addEventListener('dragleave', function() {
                uploadArea.classList.remove('border-primary');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('border-primary');
                
                if (e.dataTransfer.files.length > 0) {
                    fileInput.files = e.dataTransfer.files;
                    const fileName = e.dataTransfer.files[0].name;
                    alert(`已拖拽文件: ${fileName}`);
                }
            });
            
            // 表单提交
            const reportForm = document.getElementById('reportForm');
            reportForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const title = document.getElementById('reportTitle').value;
                const date = document.getElementById('publishDate').value;
                
                if (!fileInput.files.length) {
                    alert('请选择要上传的HTML文件');
                    return;
                }
                
                const formData = new FormData();
                formData.append('title', title);
                formData.append('publishDate', date);
                formData.append('file', fileInput.files[0]);
                
                fetch(`${API_BASE_URL}/reports`, {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        alert('财报上传成功!');
                        reportForm.reset();
                        fileInput.value = '';
                        loadReportsList();
                    } else {
                        alert(`上传失败: ${data.message}`);
                    }
                })
                .catch(error => {
                    alert(`上传出错: ${error.message}`);
                });
            });
            
            // 保存编辑
            document.getElementById('saveEdit').addEventListener('click', function() {
                const id = document.getElementById('editId').value;
                const title = document.getElementById('editTitle').value;
                const date = document.getElementById('editDate').value;
                
                fetch(`${API_BASE_URL}/reports/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: title,
                        publishDate: date
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        alert('财报信息更新成功!');
                        const editModal = bootstrap.Modal.getInstance(document.getElementById('editModal'));
                        editModal.hide();
                        loadReportsList();
                    } else {
                        alert(`更新失败: ${data.message}`);
                    }
                })
                .catch(error => {
                    alert(`更新出错: ${error.message}`);
                });
            });
            
            // 确认删除
            document.getElementById('confirmDelete').addEventListener('click', function() {
                const id = document.getElementById('deleteId').value;
                
                fetch(`${API_BASE_URL}/reports/${id}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        alert('财报已删除!');
                        const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
                        deleteModal.hide();
                        loadReportsList();
                    } else {
                        alert(`删除失败: ${data.message}`);
                    }
                })
                .catch(error => {
                    alert(`删除出错: ${error.message}`);
                });
            });
        });
        
        // 加载财报列表
        function loadReportsList() {
            const reportsList = document.getElementById('reportsList');
            
            fetch(`${API_BASE_URL}/reports`)
            .then(response => response.json())
            .then(data => {
                if (data.code === 200) {
                    reportsList.innerHTML = '';
                    
                    data.data.forEach(report => {
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td>${report.id}</td>
                            <td>${report.title}</td>
                            <td>${report.displayDate}</td>
                            <td>${report.createTime}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="editReport('${report.id}', '${report.title}', '${report.publishDate}')">编辑</button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteReport('${report.id}')">删除</button>
                            </td>
                        `;
                        
                        reportsList.appendChild(row);
                    });
                } else {
                    reportsList.innerHTML = `<tr><td colspan="5" class="text-center">加载失败: ${data.message}</td></tr>`;
                }
            })
            .catch(error => {
                reportsList.innerHTML = `<tr><td colspan="5" class="text-center">加载出错: ${error.message}</td></tr>`;
            });
        }
        
        // 编辑财报
        function editReport(id, title, date) {
            document.getElementById('editId').value = id;
            document.getElementById('editTitle').value = title;
            document.getElementById('editDate').value = date;
            
            const editModal = new bootstrap.Modal(document.getElementById('editModal'));
            editModal.show();
        }
        
        // 删除财报
        function deleteReport(id) {
            document.getElementById('deleteId').value = id;
            
            const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
            deleteModal.show();
        }
    </script>
</body>
</html>
